var t=Object.assign;!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const a=new URL(t,location),i=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,h)=>{const o=new URL(t,a);if(self[e].moduleMap[o])return s(self[e].moduleMap[o]);const n=new Blob([`import * as m from '${o}';`,`${e}.moduleMap['${o}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){h(new Error(`Failed to import: ${t}`)),i(d)},onload(){s(self[e].moduleMap[o]),i(d)}});document.head.appendChild(d)})),self[e].moduleMap={}}}("/ligif/assets/");class e{constructor(t,e,s=0,a=0){this.colorDepth=8,this.palette=[],this.pixels=[],this.isGlobalPalette=!1,this.isInterlace=!1,this.delay=200,this.w=t,this.h=e,this.x=s,this.y=a}}const s=new class{constructor(){this.workScripts=new Map,this.pools=[],this.queue=[],this.maxNum=navigator.hardwareConcurrency||2}registerWork(t,e){this.workScripts.set(t,e)}executeWork(t,e,s,a,i){const h=this.pools.filter((e=>!e.isUse&&e.name===t));if(h.length){const o=h.find((e=>e.name===t));if(o)return o.isUse=!0,this.completeHandle(o.work,e,s,a,i);{const h=this.pools.findIndex((t=>!t.isUse));return this.pools[h].work.terminate(),this.pools.splice(h,1),this.executeWork(t,e,s,a,i)}}if(this.pools.length<this.maxNum){const h=new(this.workScripts.get(t))("");return this.pools.push({name:t,work:h,isUse:!0}),this.completeHandle(h,e,s,a,i)}return new Promise(((a,i)=>{this.queue.push({name:t,args:e,transferable:s,res:a,rej:i})}))}stopWork(t){const e=this.pools.find((e=>e.work===t));if(e&&(e.isUse=!1),this.queue.length){const{name:t,args:e,res:s,rej:a,transferable:i}=this.queue.shift();this.executeWork(t,e,i,s,a)}}completeHandle(t,e,s,a,i){return t.postMessage(e,s),a&&i?(t.onmessage=e=>{a(e.data),this.stopWork(t)},t.onerror=e=>{i(e.message),this.stopWork(t)},t):new Promise(((e,s)=>{t.onmessage=s=>{e(s.data),this.stopWork(t)},t.onerror=e=>{s(e.message),this.stopWork(t)}}))}};class a extends e{constructor(){super(...arguments),this.imgData=[],this.displayType=0}async decodeToPixels(){const t=await s.executeWork("gif",{name:"decodeToPixels",imgData:this.imgData,colorDepth:this.colorDepth,palette:this.palette,h:this.h,w:this.w,transparentColorIndex:this.transparentColorIndex,isInterlace:this.isInterlace});this.pixels=t}renderToCanvas(t=!1){if(this.ctx&&!t)return this.ctx;if(!this.pixels)throw new Error("缺少数据");const e=document.createElement("canvas");this.ctx=e.getContext("2d"),e.width=this.delegate.width,e.height=this.delegate.height;let s=this.ctx.getImageData(0,0,this.w,this.h);if(this.pixels.forEach(((t,e)=>s.data[e]=t)),this.ctx.putImageData(s,this.x,this.y,0,0,this.w,this.h),!this.preFrame&&this.delegate.backgroundColor){s=this.ctx.getImageData(0,0,this.delegate.width,this.delegate.height);for(let t=0;t<s.data.length;t+=4)0===s.data[t+3]&&(s.data[t]=this.delegate.backgroundColor[0],s.data[t+1]=this.delegate.backgroundColor[1],s.data[t+2]=this.delegate.backgroundColor[2],s.data[t+3]=255)}else if((1===this.displayType||2===this.displayType)&&this.preFrame){this.preFrame.ctx||this.preFrame.renderToCanvas(t),s=this.ctx.getImageData(0,0,this.delegate.width,this.delegate.height);const e=this.preFrame.ctx.getImageData(0,0,this.delegate.width,this.delegate.height);for(let t=0;t<s.data.length;t+=4)0===s.data[t+3]&&(s.data[t]=e.data[t],s.data[t+1]=e.data[t+1],s.data[t+2]=e.data[t+2],s.data[t+3]=e.data[t+3]);this.ctx.putImageData(s,0,0)}return this.ctx}}class i{constructor(){this.frames=[],this.times=0,this.offset=0}get backgroundColor(){return"backgroundColorIndex"in this&&this.globalPalette?[this.globalPalette[this.backgroundColorIndex],this.globalPalette[this.backgroundColorIndex+1],this.globalPalette[this.backgroundColorIndex+2]]:null}async readData(t){const e=new FileReader;return e.readAsArrayBuffer(t),e.onload=this.handleImageData.bind(this),await new Promise((t=>e.onload=()=>{t(!0)})),await this.handleImageData(e.result),this}async readCodes(t){return await this.handleImageData(t),this}async handleImageData(t){this.dataSource=new Uint8Array(t),this.readHeader(),this.readLogicalScreenDescriptor(),this.readExtension(),await Promise.all(this.frames.map((t=>t.decodeToPixels())))}read(t=1){return this.dataSource.slice(this.offset,this.offset+=t)}readOne(){return this.dataSource.slice(this.offset,this.offset+=1)[0]}onlyReadOne(){return this.dataSource.slice(this.offset,this.offset+1)[0]}readHeader(){if("GIF"!==this.read(3).reduce(((t,e)=>t+String.fromCharCode(e)),""))throw new Error("gif签名无效");const t=this.read(3).reduce(((t,e)=>t+String.fromCharCode(e)),"");this.version=t}readLogicalScreenDescriptor(){const t=this.readOne()+(this.readOne()<<8),e=this.readOne()+(this.readOne()<<8);this.width=t,this.height=e;const s=this.readOne(),a=!!(s>>7&1),i=7&s,h=this.readOne();if(this.readOne(),a){const t=2**(i+1)*3;this.globalPalette=this.readColorTable(t),this.backgroundColorIndex=h}}readColorTable(t){const e=[];let s=3;for(;s<=t;){const t=this.read(3);e.push(t[0]),e.push(t[1]),e.push(t[2]),s+=3}return e}readExtension(){switch(this.readOne()){case 33:switch(this.readOne()){case 249:this.readGraphicsControlExtension(),this.readExtension();break;case 254:this.readCommentExtension(),this.readExtension();break;case 255:this.readApplicationExtension(),this.readExtension();break;case 1:this.readPlainTextExtension(),this.readExtension()}break;case 44:this.readImageDescriptor(),this.readExtension();break;case 59:break;case 0:this.readExtension();break;default:throw new Error("错误的格式")}}readGraphicsControlExtension(){this.readOne();const t=this.readOne(),e=t>>2&7,s=!!(1&t),a=10*(this.readOne()+(this.readOne()<<8)),i=this.readOne();this.frameOptions={displayType:e,delay:a,transparentColorIndex:s?i:void 0},this.readOne()}readCommentExtension(){const t=this.readOne(),e=this.read(t+1);this.commit=e.reduce(((t,e)=>t+String.fromCharCode(e)),"")}readApplicationExtension(){const t=this.readOne();if(11!==t)throw new Error("解析失败: application extension is invalid data");const e=this.read(t);for(this.appVersion=e.reduce(((t,e)=>t+String.fromCharCode(e)),""),this.readOne(),this.readOne(),this.times=this.readOne();this.onlyReadOne();)this.readOne()}readPlainTextExtension(){const t=this.readOne();this.read(t)}readImageDescriptor(){const t=this.frameOptions||{};this.frameOptions=void 0;const e=this.readOne()+(this.readOne()<<8),s=this.readOne()+(this.readOne()<<8),i=this.readOne()+(this.readOne()<<8),h=this.readOne()+(this.readOne()<<8),o=new a(i,h,e,s);o.delegate=this,o.preFrame=this.frames[this.frames.length-1],Object.assign(o,t);const n=this.readOne(),d=!!(n>>7&1);o.isInterlace=!!(n>>6&1);if(d){const t=2**((7&n)+1)*3;o.palette=this.readColorTable(t)}else o.isGlobalPalette=!0,o.palette=this.globalPalette;o.colorDepth=this.readOne();const l=[];let r=this.readOne();for(;r;)this.read(r).forEach((t=>l.push(t))),r=this.readOne();o.imgData=l,o.w&&o.h&&this.frames.push(o)}}class h extends e{constructor(){super(...arguments),this.indexs=[],this.displayType=0,this.isZip=!1,this.hasTransparenc=!1}}const o=3*Math.max(499,491,487,503),n={ncycles:100,netsize:256,samplefac:10};class d{constructor(t,e){if(Object.assign(this,n,{pixels:t},e),this.netsize<4||this.netsize>256)throw new Error("Color count must be between 4 and 256");if(this.samplefac<1||this.samplefac>30)throw new Error("Sampling factor must be between 1 and 30");this.maxnetpos=this.netsize-1,this.netbiasshift=4,this.intbiasshift=16,this.intbias=1<<this.intbiasshift,this.gammashift=10,this.gamma=1<<this.gammashift,this.betashift=10,this.beta=this.intbias>>this.betashift,this.betagamma=this.beta*this.gamma,this.initrad=this.netsize>>3,this.radiusbiasshift=6,this.radiusbias=1<<this.radiusbiasshift,this.initradius=this.initrad*this.radiusbias,this.radiusdec=30,this.alphabiasshift=10,this.initalpha=1<<this.alphabiasshift,this.radbiasshift=8,this.radbias=1<<this.radbiasshift,this.alpharadbshift=this.alphabiasshift+this.radbiasshift,this.alpharadbias=1<<this.alpharadbshift,this.network=[],this.netindex=new Uint32Array(256),this.bias=new Uint32Array(this.netsize),this.freq=new Uint32Array(this.netsize),this.radpower=new Uint32Array(this.netsize>>3);for(let s=0,a=this.netsize;s<a;s++){const t=(s<<this.netbiasshift+8)/this.netsize;this.network[s]=new Float64Array([t,t,t,0]),this.freq[s]=this.intbias/this.netsize,this.bias[s]=0}}unbiasnet(){for(let t=0,e=this.netsize;t<e;t++)this.network[t][0]>>=this.netbiasshift,this.network[t][1]>>=this.netbiasshift,this.network[t][2]>>=this.netbiasshift,this.network[t][3]=t}altersingle(t,e,s,a,i){this.network[e][0]-=t*(this.network[e][0]-s)/this.initalpha,this.network[e][1]-=t*(this.network[e][1]-a)/this.initalpha,this.network[e][2]-=t*(this.network[e][2]-i)/this.initalpha}alterneigh(t,e,s,a,i){const h=Math.abs(e-t),o=Math.min(e+t,this.netsize);let n=e+1,d=e-1,l=1;for(;n<o||d>h;){const t=this.radpower[l++];if(n<o){const e=this.network[n++];e[0]-=t*(e[0]-s)/this.alpharadbias,e[1]-=t*(e[1]-a)/this.alpharadbias,e[2]-=t*(e[2]-i)/this.alpharadbias}if(d>h){const e=this.network[d--];e[0]-=t*(e[0]-s)/this.alpharadbias,e[1]-=t*(e[1]-a)/this.alpharadbias,e[2]-=t*(e[2]-i)/this.alpharadbias}}}contest(t,e,s){let a=~(1<<31),i=a,h=-1,o=h;for(let n=0,d=this.netsize;n<d;n++){const d=this.network[n],l=Math.abs(d[0]-t)+Math.abs(d[1]-e)+Math.abs(d[2]-s);l<a&&(a=l,h=n);const r=l-(this.bias[n]>>this.intbiasshift-this.netbiasshift);r<i&&(i=r,o=n);const c=this.freq[n]>>this.betashift;this.freq[n]-=c,this.bias[n]+=c<<this.gammashift}return this.freq[h]+=this.beta,this.bias[h]-=this.betagamma,o}inxbuild(){let t=0,e=0;for(let s=0,a=this.netsize;s<a;s++){const i=this.network[s];let h=null,o=s,n=i[1];for(let t=s+1;t<a;t++)h=this.network[t],h[1]<n&&(o=t,n=h[1]);if(h=this.network[o],s!==o&&([i[0],h[0]]=[h[0],i[0]],[i[1],h[1]]=[h[1],i[1]],[i[2],h[2]]=[h[2],i[2]],[i[3],h[3]]=[h[3],i[3]]),n!==t){this.netindex[t]=e+s>>1;for(let e=t+1;e<n;e++)this.netindex[e]=s;t=n,e=s}}this.netindex[t]=e+this.maxnetpos>>1;for(let s=t+1;s<256;s++)this.netindex[s]=this.maxnetpos}learn(){const t=this.pixels.length,e=30+(this.samplefac-1)/3,s=t/(3*this.samplefac);let a,i=s/this.ncycles|0,h=this.initalpha,n=this.initradius,d=n>>this.radiusbiasshift;d<=1&&(d=0);for(let o=0;o<d;o++)this.radpower[o]=h*((d*d-o*o)*this.radbias/(d*d));t<o?(this.samplefac=1,a=3):a=t%499!=0?1497:t%491!=0?1473:t%487!=0?1461:1509;let l=0;for(let o=0;o<s;){const s=(255&this.pixels[l])<<this.netbiasshift,r=(255&this.pixels[l+1])<<this.netbiasshift,c=(255&this.pixels[l+2])<<this.netbiasshift,p=this.contest(s,r,c);if(this.altersingle(h,p,s,r,c),0!==d&&this.alterneigh(d,p,s,r,c),l+=a,l>=t&&(l-=t),0===i&&(i=1),++o%i==0){h-=h/e,n-=n/this.radiusdec,d=n>>this.radiusbiasshift,d<=1&&(d=0);for(let t=0;t<d;t++)this.radpower[t]=h*((d*d-t*t)*this.radbias/(d*d))}}}buildColorMap(){this.learn(),this.unbiasnet(),this.inxbuild()}getColorMap(){const t=new Uint8Array(3*this.netsize),e=new Uint8Array(this.netsize);for(let s=0,a=this.netsize;s<a;s++)e[this.network[s][3]]=s;for(let s=0,a=0,i=0,h=this.netsize;s<h;s++)i=e[s],t[a++]=255&this.network[i][0],t[a++]=255&this.network[i][1],t[a++]=255&this.network[i][2];return t}}const l={time:0,colorDiff:1},r="NETSCAPE2.0".split("").map((t=>t.charCodeAt(0)));class c{constructor(e,s,a={}){this.globalPalette=[],this.codes=[],this.frames=[];const i=t(t({},l),a);this.w=e,this.h=s,this.time=i.time,this.colorDiff=i.colorDiff}addFrame(t){const e=this.toImageData(t),s=new h(e.w,e.h);s.pixels=e.pixels,s.delay=e.delay||200,this.frames.push(s)}addFrames(t){t.forEach((t=>this.addFrame(t)))}async encode(){return await this.optimizeImagePixels(),this.parseFramePalette(),await this.encodeFramePixels(),this.writeHeader(),this.writeLogicalScreenDescriptor(),this.writeApplicationExtension(),this.writeGraphicsControlExtension(),this.addCode(59),this}toBlob(){const t=new ArrayBuffer(this.codes.length),e=new DataView(t);return this.codes.forEach(((t,s)=>e.setUint8(s,t))),new window.Blob([e],{type:"image/gif"})}async encodeByVideo(t){t.src instanceof File&&(t.src=URL.createObjectURL(t.src));const e=document.createElement("video");return e.controls=!0,e.src=t.src,await new Promise(((s,a)=>{const i=1e3/t.fps,h=[];let o=t.from;try{function n(){o<Math.min(t.to,e.duration)?(e.currentTime=o,o+=i/1e3):s(h)}e.onseeked=()=>{const t=document.createElement("canvas");t.width=this.w||e.videoWidth,t.height=this.h||e.videoHeight;t.getContext("2d").drawImage(e,0,0,t.width,t.height),this.addFrame({img:t,delay:i}),n()},e.onloadeddata=()=>{n()}}catch(d){a(d)}})),this.encode()}addCode(t){this.codes.push(t)}addCodes(t){this.codes.push(...t)}writeHeader(){this.addCodes(this.strTocode("GIF89a"))}writeLogicalScreenDescriptor(){this.addCodes([255&this.w,this.w>>8]),this.addCodes([255&this.h,this.h>>8]);const t=this.globalPalette;let e=128;e+=0,e+=0,e+=t.length?Math.ceil(Math.log2(t.length/3))-1:0,this.addCode(e),this.addCode(0),this.addCode(255),this.addCodes(t)}writeApplicationExtension(){1!==this.time&&(this.addCode(33),this.addCode(255),this.addCode(11),this.addCodes(r),this.addCode(3),this.addCode(1),this.addCodes([255&(this.time>1?this.time-1:0)]),this.addCode((this.time>1?this.time-1:0)>>8),this.addCode(0))}writeGraphicsControlExtension(){const t=this.globalPalette;this.frames.filter((t=>t.w&&t.h)).forEach((e=>{this.addCode(33),this.addCode(249),this.addCode(4);let s=0,a=0;(e.x||e.y||e.hasTransparenc)&&(a=1),s+=a<<2,s+=2,s+=e.hasTransparenc?1:0,this.addCode(s);const i=Math.floor(e.delay/10);this.addCodes([255&i,i>>8]),this.addCode(e.transparentColorIndex||0),this.addCode(0),this.addCode(44),this.addCodes([255&e.x,e.x>>8]),this.addCodes([255&e.y,e.y>>8]),this.addCodes([255&e.w,e.w>>8]),this.addCodes([255&e.h,e.h>>8]),s=0;const h=e.isGlobalPalette,o=h?t:e.palette,n=Math.ceil(Math.log2(o.length/3))-1,d=n+1;h||(s=128|n),this.addCode(s),h||this.addCodes(o),this.addCode(d);const l=[...e.pixels];let r=l.length;for(;r>0;)this.addCode(Math.min(r,255)),this.addCodes(l.splice(0,255)),r-=255;this.addCode(0)}))}toImageData(t){const e=document.createElement("canvas");e.width=this.w,e.height=this.h;const s=e.getContext("2d");return s.drawImage(t.img,0,0,this.w,this.h),{w:e.width,h:e.height,delay:t.delay,pixels:[...s.getImageData(0,0,this.w,this.h).data]}}async optimizeImagePixels(){const t=await s.executeWork("gif",{name:"optimizePixels",frames:this.frames,width:this.w,maxDiff:this.colorDiff});this.frames.forEach(((e,s)=>{let a=!1;const{paletteMap:i,transparencCount:h,x:o,y:n,w:l,h:r,newPixels:c}=t[s];let p=t[s].palette;if(i.size>256){const t=new d(p,{netsize:h>0?255:256,samplefac:1});a=!0,t.buildColorMap(),p=[...t.getColorMap()]}e.x=o,e.y=n,e.w=l,e.h=r,e.isZip=a,e.hasTransparenc=h>0,e.palette=p,e.pixels=c}))}parseFramePalette(){const t=this.frames.reduce(((t,e)=>{if(!t)return e;if(e.isZip)return t;const s=Math.floor(Math.log2(t.palette.length/3)),a=Math.floor(Math.log2(e.palette.length/3));return s<a||s===a&&t.palette.length>e.palette.length?e:t}),null),e=t.palette;let s,a=t.hasTransparenc;a&&(s=e.length/3,e.push(0,0,0)),this.frames.forEach((i=>{if(i===t)return;const h=i.palette,o=e.slice(),n=[];for(let t=0;t<h.length;t+=3){let s=!1;for(let a=0;a<o.length;a+=3)h[t]===e[a]&&h[t+1]===e[a+1]&&h[t+2]===e[a+2]&&(s=!0);s||n.push(...h.slice(t,t+3))}const d=(e.length+n.length)/3+(i.hasTransparenc&&!a?1:0)>1<<Math.ceil(Math.log2(e.length/3));if(i.hasTransparenc)if(d){const t=h.length/3;i.transparentColorIndex=t,h.push(0,0,0)}else a?i.transparentColorIndex=s:(s=e.length/3,i.transparentColorIndex=s,e.push(0,0,0),a=!0);d?(i.isGlobalPalette=!1,i.palette=this.fillPalette([...h])):(e.push(...n),i.isGlobalPalette=!0)})),t.hasTransparenc=a,t.transparentColorIndex=s,t.isGlobalPalette=!0,t.palette=this.fillPalette(e),this.globalPalette=t.palette}fillPalette(t){const e=(1<<Math.max(Math.ceil(Math.log2(t.length/3)),2))-t.length/3,s=new Array(3*e);return s.fill(0),t.concat(s)}async encodeFramePixels(){const t=this.globalPalette;return Promise.all(this.frames.map((async e=>{const a=e.isZip,i=e.transparentColorIndex,h=e.isGlobalPalette,o=e.pixels,n=[],d=h?t:e.palette;for(let t=0;t<o.length;t+=4)if(0===o[t+3])n.push(i);else{const e=o[t],s=o[t+1],i=o[t+2];if(a){let t=0,a=16777216;for(let h=0;h<d.length;h+=3){const o=e-d[h],n=s-d[h+1],l=i-d[h+2],r=o*o+n*n+l*l,c=h/3|0;r<a&&(a=r,t=c),h+=1}n.push(t)}else for(let t=0;t<d.length;t+=3)if(d[t]===e&&d[t+1]===s&&d[t+2]===i){n.push(t/3);break}}const l=Uint8Array.from(n),r=await s.executeWork("gif",{name:"encode",width:e.w,height:e.h,colorDepth:Math.log2(d.length/3),codes:l});return e.pixels=r,e})))}strTocode(t){return t.split("").map((t=>t.charCodeAt(0)))}}s.registerWork("gif",(function(){return new Worker("data:application/javascript;base64,dmFyIHQ9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxlPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMsaT1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlO2NsYXNzIHN7Y29uc3RydWN0b3IodCl7dGhpcy5pbmRleD0wLHRoaXMucmVtYWluaW5nQml0cz04LHRoaXMuY29kZXM9W10sdGhpcy5kZWZhdWx0Q29sb3JTaXplPU1hdGgubWF4KDIsdCksdGhpcy5pbml0KCl9ZGVjb2RlKHQpe3RoaXMuYnVmZmVycz10O2NvbnN0IGU9W107bGV0IGkscz10aGlzLmNsZWFyQ29kZTtmb3IoO2k9cyxzPXRoaXMubmV4dENvZGUoKSxzIT09dGhpcy5lbmRDb2RlOylpZihzIT09dGhpcy5jbGVhckNvZGUpe2lmKHM8dGhpcy5kaWN0LnNpemUpaSE9PXRoaXMuY2xlYXJDb2RlJiZ0aGlzLmluc2VydFNlcSh0aGlzLmdldENvZGVTZXEoaSkuY29uY2F0KHRoaXMuZ2V0Q29kZVNlcShzKVswXSkpO2Vsc2V7aWYocyE9PXRoaXMuZGljdC5zaXplKXRocm93IG5ldyBFcnJvcigi5peg5pWI55qE5Zu+5b2i5pWw5o2uIik7Y29uc3QgdD10aGlzLmdldENvZGVTZXEoaSk7dGhpcy5pbnNlcnRTZXEodC5jb25jYXQodFswXSkpfWUucHVzaCguLi50aGlzLmdldENvZGVTZXEocykpLHRoaXMuZGljdC5zaXplPT09MTw8dGhpcy5jb2xvclNpemUmJnRoaXMuY29sb3JTaXplPDEyJiYodGhpcy5jb2xvclNpemUrPTEpfWVsc2UgdGhpcy5pbml0KCk7cmV0dXJuIFVpbnQ4QXJyYXkuZnJvbShlKX1pbml0KCl7dGhpcy5jb2xvclNpemU9dGhpcy5kZWZhdWx0Q29sb3JTaXplLHRoaXMuZGljdD1uZXcgTWFwO2ZvcihsZXQgdD0wO3Q8MioqdGhpcy5jb2xvclNpemU7dCs9MSl0aGlzLmluc2VydFNlcShbdF0pO3RoaXMuY2xlYXJDb2RlPTE8PHRoaXMuY29sb3JTaXplLHRoaXMuZW5kQ29kZT10aGlzLmNsZWFyQ29kZSsxLHRoaXMuY29sb3JTaXplKz0xLHRoaXMuaW5zZXJ0U2VxKFt0aGlzLmNsZWFyQ29kZV0pLHRoaXMuaW5zZXJ0U2VxKFt0aGlzLmVuZENvZGVdKX1pbnNlcnRTZXEodCl7Y29uc3QgZT10aGlzLmRpY3Quc2l6ZTt0aGlzLmRpY3Quc2V0KGUsdCl9Z2V0Q29kZVNlcSh0KXtyZXR1cm4gdGhpcy5kaWN0LmdldCh0KX1uZXh0Q29kZSgpe2xldCB0PXRoaXMuY29sb3JTaXplLGU9MCxpPTA7Zm9yKDt0PjAmJnZvaWQgMCE9PXRoaXMuYnVmZmVyc1t0aGlzLmluZGV4XTspe2NvbnN0IHM9dGhpcy5idWZmZXJzW3RoaXMuaW5kZXhdLG89TWF0aC5taW4odCx0aGlzLnJlbWFpbmluZ0JpdHMpO2U9KHM+PjgtdGhpcy5yZW1haW5pbmdCaXRzJigxPDxvKS0xKTw8aXxlLHQtPXRoaXMucmVtYWluaW5nQml0cyx0aGlzLnJlbWFpbmluZ0JpdHMtPW8saSs9byx0aGlzLnJlbWFpbmluZ0JpdHM8PTAmJih0aGlzLmluZGV4Kz0xLHRoaXMucmVtYWluaW5nQml0cz10aGlzLnJlbWFpbmluZ0JpdHMlOCs4KX1yZXR1cm4gdGhpcy5jb2Rlcy5wdXNoKGUpLGV9fWNsYXNzIG97Y29uc3RydWN0b3IodCxlLGkpe3RoaXMuZGljdD1uZXcgTWFwLHRoaXMuZGljdDI9bmV3IE1hcCx0aGlzLnJlbWFpbmluZ0JpdHM9OCx0aGlzLmluZGV4PTAsdGhpcy5jb2Rlcz1bXSx0aGlzLmRlZmF1bHRDb2xvclNpemU9TWF0aC5tYXgoMixpKSx0aGlzLmJ1ZmZlcnM9bmV3IFVpbnQ4QXJyYXkodCplKzEwMCksdGhpcy5pbml0KCl9aW5pdCgpe3RoaXMuY29sb3JTaXplPXRoaXMuZGVmYXVsdENvbG9yU2l6ZSsxLHRoaXMuZGljdC5jbGVhcigpO2ZvcihsZXQgdD0wO3Q8MioqdGhpcy5kZWZhdWx0Q29sb3JTaXplO3QrPTEpdGhpcy5pbnNlcnRTZXEodCk7dGhpcy5jbGVhckNvZGU9MTw8dGhpcy5kZWZhdWx0Q29sb3JTaXplLHRoaXMuZW5kQ29kZT10aGlzLmNsZWFyQ29kZSsxLHRoaXMuaW5zZXJ0U2VxKHRoaXMuY2xlYXJDb2RlKSx0aGlzLmluc2VydFNlcSh0aGlzLmVuZENvZGUpfWluc2VydFNlcSh0KXtjb25zdCBlPXRoaXMuZGljdC5zaXplO3RoaXMuZGljdC5zZXQodCxlKSx0aGlzLmRpY3QyLnNldCh0LGUpfWdldFNlcUNvZGUodCl7cmV0dXJuIHRoaXMuZGljdC5nZXQodCl9ZW5jb2RlKHQpe2xldCBlPSIiLGk9MDtmb3IodGhpcy5wdXNoQ29kZSh0aGlzLmNsZWFyQ29kZSk7aTx0Lmxlbmd0aDspezQwOTc9PT10aGlzLmRpY3Quc2l6ZT8odGhpcy5wdXNoQ29kZSh0aGlzLmNsZWFyQ29kZSksdGhpcy5pbml0KCkpOnRoaXMuZGljdC5zaXplPT09MSsoMTw8dGhpcy5jb2xvclNpemUpJiYodGhpcy5jb2xvclNpemUrPTEpO2NvbnN0IHM9dFtpXSxvPSIiIT09ZT9gJHtlfSwke3N9YDpzO3ZvaWQgMCE9PXRoaXMuZ2V0U2VxQ29kZShvKSYmdm9pZCAwIT09dFtpKzFdP2U9bzoodGhpcy5pbnNlcnRTZXEobyksdGhpcy5wdXNoQ29kZSh0aGlzLmdldFNlcUNvZGUoZSkpLGU9cyksaSs9MX1yZXR1cm4gdGhpcy5wdXNoQ29kZSh0aGlzLmdldFNlcUNvZGUoZSkpLHRoaXMucHVzaENvZGUodGhpcy5lbmRDb2RlKSx0aGlzLmJ1ZmZlcnMuc2xpY2UoMCx0aGlzLmluZGV4KzEpfXB1c2hDb2RlKHQpe3RoaXMuY29kZXMucHVzaCh0KTtsZXQgZT10aGlzLmNvbG9yU2l6ZSxpPXQ7Zm9yKDtlPj0wOyl7Y29uc3QgdD1NYXRoLm1pbihlLHRoaXMucmVtYWluaW5nQml0cykscz10aGlzLmJ1ZmZlcnNbdGhpcy5pbmRleF18aTw8OC10aGlzLnJlbWFpbmluZ0JpdHMmMjU1O3RoaXMuYnVmZmVyc1t0aGlzLmluZGV4XT1zLGk+Pj10LGUtPXRoaXMucmVtYWluaW5nQml0cyx0aGlzLnJlbWFpbmluZ0JpdHMtPXQsdGhpcy5yZW1haW5pbmdCaXRzPD0wJiYodGhpcy5pbmRleCs9MSx0aGlzLnJlbWFpbmluZ0JpdHM9dGhpcy5yZW1haW5pbmdCaXRzJTgrOCl9fX1zZWxmLm9ubWVzc2FnZT1oPT57Y29uc3Qgbj1oLmRhdGEse25hbWU6cn09bixhPSgocyxvKT0+e3ZhciBoPXt9O2Zvcih2YXIgbiBpbiBzKXQuY2FsbChzLG4pJiZvLmluZGV4T2Yobik8MCYmKGhbbl09c1tuXSk7aWYobnVsbCE9cyYmZSlmb3IodmFyIG4gb2YgZShzKSlvLmluZGV4T2Yobik8MCYmaS5jYWxsKHMsbikmJihoW25dPXNbbl0pO3JldHVybiBofSkobixbIm5hbWUiXSk7aWYoImVuY29kZSI9PT1yKXtjb25zdCB0PW5ldyBvKGEud2lkdGgsYS5oZWlnaHQsYS5jb2xvckRlcHRoKTtzZWxmLnBvc3RNZXNzYWdlKHQuZW5jb2RlKGEuY29kZXMpKX1lbHNlImRlY29kZVRvUGl4ZWxzIj09PXI/c2VsZi5wb3N0TWVzc2FnZShmdW5jdGlvbih0KXtjb25zdCBlPW5ldyBzKHQuY29sb3JEZXB0aCkuZGVjb2RlKHQuaW1nRGF0YSksaT1bXTtpZih0LmlzSW50ZXJsYWNlKXtjb25zdCBzPVswLDQsMiwxXSxvPVs4LDgsNCwyXTtsZXQgaD0wO2ZvcihsZXQgbj0wO248NDtuKz0xKWZvcihsZXQgcj1zW25dO3I8dC5oO3IrPW9bbl0pZm9yKGxldCBzPTA7czx0Lnc7cys9MSl7Y29uc3Qgbz0oci0xKSp0LncqNCs0KnMsbj1lW2hdO2lbb109dC5wYWxldHRlWzMqbl0saVtvKzFdPXQucGFsZXR0ZVszKm4rMV0saVtvKzJdPXQucGFsZXR0ZVszKm4rMl0saVtvKzNdPW49PT10LnRyYW5zcGFyZW50Q29sb3JJbmRleD8wOjI1NSxoKz0xfX1lbHNlIGUuZm9yRWFjaCgoZT0+e2kucHVzaCh0LnBhbGV0dGVbMyplXSksaS5wdXNoKHQucGFsZXR0ZVszKmUrMV0pLGkucHVzaCh0LnBhbGV0dGVbMyplKzJdKSxpLnB1c2goZT09PXQudHJhbnNwYXJlbnRDb2xvckluZGV4PzA6MjU1KX0pKTtyZXR1cm4gaX0oYSkpOiJvcHRpbWl6ZVBpeGVscyI9PT1yJiZzZWxmLnBvc3RNZXNzYWdlKGZ1bmN0aW9uKHQsZSxpPTMwKXtjb25zdCBzPVtdO2Z1bmN0aW9uIG8odCxlKXtjb25zdCBpPSh0WzBdK2VbMF0pLzIscz10WzBdLWVbMF0sbz10WzFdLWVbMV0saD10WzJdLWVbMl07cmV0dXJuIE1hdGguc3FydCgoKGkrNTEyKSpzKnM+PjgpK28qbyo0KygoNzY3LWkpKmgqaD4+OCkpfXJldHVybiB0Lm1hcCgodD0+e2NvbnN0IGg9bmV3IE1hcCxuPVtdO2xldCByPXQueCxhPXQueSxjPXQudyxkPXQuaDtjb25zdCBsPXQucGl4ZWxzO2xldCBmPVtdLHA9MCx1PSExLEM9MCxTPTAsZz1jLG09Yyx6PTA7Zm9yKGxldCBCPTA7QjxsLmxlbmd0aDtCKz00KXtjb25zdCB0PShhK01hdGguZmxvb3IoQi8oNCpjKSkpKmUqNCs0KihCJSg0KmMpLzQrciksZD1sW0JdLHg9c1t0XSxxPWxbQisxXSx3PXNbdCsxXSxNPWxbQisyXSxiPXNbdCsyXSx5PWxbQiszXTtpZihCLzQlYz09MCYmKFM9MCksbyhbZCxxLE1dLFt4LHcsYl0pPGl8fDA9PT15KTA9PT15P2YucHVzaCgwLDAsMCwwKTpmLnB1c2goZCxxLE0sMCkseis9MSx1fHwocCs9MSksUys9MSxDKz0xO2Vsc2V7Y29uc3QgZT1gJHtkfSwke3F9LCR7TX1gO2guaGFzKGUpfHwobi5wdXNoKGQscSxNKSxoLnNldChlLCEwKSksZi5wdXNoKGQscSxNLHkpLHNbdF09ZCxzW3QrMV09cSxzW3QrMl09TSxzW3QrM109eSx1fHwodT0hMCksZz1TPGc/UzpnLEM9MH1pZigwIT09bSYmKEIvNCsxKSVjPT0wKXtjb25zdCB0PUMlYzttPXQ8bT90Om19fXotPXArQztjb25zdCB4PU1hdGguZmxvb3IocC9jKTtsZXQgcT0wLHc9bC5sZW5ndGg7eCYmKHE9eCpjKjQsYSs9eCxkLT14KTtjb25zdCBNPU1hdGguZmxvb3IoQy9jKTtyZXR1cm4gTSYmKHctPU0qYyo0LGQtPU0pLGY9Zi5zbGljZShxLHcpLChtfHxnKSYmKGY9Zi5maWx0ZXIoKCh0LGUpPT57Y29uc3QgaT1NYXRoLmZsb29yKGUvNCklYztyZXR1cm4hKGk8Z3x8aT49Yy1tKX0pKSxyKz1nLGMtPWcrbSkse25ld1BpeGVsczpmLHg6cix5OmEsdzpjLGg6ZCxwYWxldHRlOm4sdHJhbnNwYXJlbmNDb3VudDp6LHBhbGV0dGVNYXA6aH19KSl9KGguZGF0YS5mcmFtZXMsaC5kYXRhLndpZHRoLGguZGF0YS5tYXhEaWZmKSl9Owo=",{type:"module"})})),window.GIFEncoder=c,window.GIFDecoder=i;const p=document.getElementById("img1"),m=document.getElementById("img2"),b=document.getElementById("img3"),u=new c(p.width,p.height,{time:10,colorDiff:10});u.addFrame({img:p,delay:1e3}),u.addFrame({img:m,delay:1e3}),u.addFrame({img:b,delay:1e3}),u.encode().then((()=>{const t=document.createElement("img");t.src=URL.createObjectURL(u.toBlob()),document.body.appendChild(t)}));const g=document.getElementById("file");g.onchange=()=>{const t=new c(320,180);console.time("video time"),t.encodeByVideo({src:g.files[0],from:3,to:40,fps:5}).then((()=>{const e=document.createElement("img");e.src=URL.createObjectURL(t.toBlob()),document.body.appendChild(e),console.timeEnd("video time")}))},document.getElementById("main").addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault();const e=t.dataTransfer.files[0],s=new i;window.gif=s,console.time("decode time"),s.readData(e).then((t=>{console.timeEnd("decode time"),t.frames.forEach((t=>document.querySelector("#imgs").appendChild(t.renderToCanvas().canvas)));const e=t.width,s=t.width/e,a=new c(e,t.height/s,{colorDiff:1});window.gIFEncoder=a,a.addFrames(t.frames.map((t=>({img:t.ctx.canvas,delay:t.delay})))),console.time("encode time"),a.encode().then((()=>{console.timeEnd("encode time");const t=document.createElement("img");t.src=URL.createObjectURL(a.toBlob()),document.querySelector("#imgs").insertBefore(t,document.querySelector("canvas"))}))}))})),document.getElementById("main").addEventListener("dragover",(t=>{t.stopPropagation(),t.preventDefault()}));
